<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<meta name="theme-color" content="#001122">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<meta name="description" content="ŸÖÿ±ÿßÿ¨ÿπÿ© ÿßŸÑÿµÿ≠ÿßŸÅÿ© ÿßŸÑÿ£ÿ≥ÿ®ŸàÿπŸäÿ©">
<title>ŸÖÿ±ÿßÿ¨ÿπÿ© ÿßŸÑÿµÿ≠ÿßŸÅÿ© ÿßŸÑÿ£ÿ≥ÿ®ŸàÿπŸäÿ©</title>
<link rel="icon" type="image/png" href="images1/00011.png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">
<style>
/* (Le CSS reste strictement identique √† votre version originale) */
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
:root { --primary: #1a73e8; --primary-dark: #0d5cb6; --background: #001122; --card-bg: #001a44; --text: #ffffff; --text-secondary: #cccccc; --accent-1: #FF6B6B; --accent-2: #4ECDC4; --accent-3: #FFD166; --shadow: 0 2px 10px rgba(0, 0, 0, 0.3); --radius: 8px; --transition: all 0.3s ease; }
html { font-size: 16px; -webkit-text-size-adjust: 100%; text-size-adjust: 100%; }
body { font-family: 'Tajawal', -apple-system, sans-serif; background: var(--background); color: var(--text); line-height: 1.4; overflow-x: hidden; min-height: 100vh; -webkit-font-smoothing: antialiased; padding: 0; margin: 0; }
.app-header { background: #001122; padding: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); position: sticky; top: 0; z-index: 100; width: 100%; }
.main-title { font-size: 1.5rem; font-weight: 900; color: white; text-align: center; margin-bottom: 15px; }
.filters-container { display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px; }
.search-wrapper { display: flex; align-items: center; background: rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 5px; border: 1px solid rgba(255, 255, 255, 0.2); }
#search-input { flex: 1; padding: 12px; background: transparent; border: none; color: var(--text); font-size: 16px; outline: none; text-align: right; direction: rtl; }
.date-filters { display: flex; flex-direction: column; gap: 10px; }
.date-group { display: flex; align-items: center; gap: 10px; }
.date-input-wrapper { flex: 1; background: rgba(255, 255, 255, 0.1); border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.2); }
.date-input { width: 100%; padding: 12px; background: transparent; border: none; color: var(--text); direction: rtl; }
.period-presets { display: flex; gap: 8px; margin-bottom: 10px; overflow-x: auto; padding-bottom: 5px; }
.preset-btn { background: rgba(255, 255, 255, 0.1); color: var(--text); border: 1px solid rgba(255, 255, 255, 0.2); padding: 12px 15px; border-radius: 8px; white-space: nowrap; cursor: pointer; }
.preset-btn.active { background: var(--primary); color: white; }
.action-buttons { display: flex; gap: 10px; margin-top: 10px; }
.clear-filters-btn, .download-pdf-btn { flex: 1; padding: 14px; border-radius: 8px; font-weight: 600; border: none; cursor: pointer; color: white; }
.clear-filters-btn { background: linear-gradient(135deg, var(--accent-1), #ff5252); }
.download-pdf-btn { background: linear-gradient(135deg, #4CAF50, #2E7D32); }
#articles-container { padding: 10px; display: flex; flex-direction: column; gap: 15px; }
.article-card { background: var(--card-bg); border-radius: 10px; overflow: hidden; box-shadow: var(--shadow); border: 1px solid rgba(255, 255, 255, 0.05); cursor: pointer; }
.article-image-container { position: relative; width: 100%; height: 200px; background: #000428; }
.title-overlay { position: absolute; bottom: 0; left: 0; width: 100%; padding: 15px; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); }
.article-main-title { font-size: 1.3rem; font-weight: 900; color: white; line-height: 1.3; }
.metadata-badges { position: absolute; top: 10px; left: 0; width: 100%; display: flex; flex-direction: column; gap: 8px; padding: 0 10px; }
.metadata-badge { padding: 8px 12px; font-size: 0.8rem; border-radius: 20px; color: white; max-width: fit-content; }
.date-badge { background: rgba(255, 107, 107, 0.9); align-self: flex-end; }
.category-badge { background: rgba(78, 205, 196, 0.9); align-self: flex-end; }
.pagination-container { display: flex; justify-content: center; align-items: center; padding: 15px; gap: 5px; flex-wrap: wrap; }
.pagination-btn { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; cursor: pointer; }
.pagination-number { width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.1); border-radius: 8px; cursor: pointer; }
.pagination-number.active { background: var(--primary); }
#article-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); z-index: 1000; }
.overlay-container { width: 100%; height: 100%; display: flex; flex-direction: column; }
.overlay-header-extended { padding: 15px; background: #001a44; display: flex; justify-content: space-between; align-items: center; }
.close-overlay { width: 40px; height: 40px; border-radius: 50%; background: var(--accent-1); border: none; color: white; font-size: 1.5rem; cursor: pointer; }
.article-frame-container { flex: 1; background: white; }
#article-frame { width: 100%; height: 100%; border: none; }
</style>
</head>
<body>
<header class="app-header">
  <div class="title-search-container">
    <h1 class="main-title"><img src="images/title.png" style="max-height: 50px;"></h1>
    <div class="filters-container">
      <div class="search-wrapper">
        <input type="text" id="search-input" placeholder="ÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÖŸÇÿßŸÑÿßÿ™...">
        <button id="clear-search" style="background:none; border:none; color:white; padding:0 10px; cursor:pointer;">‚úï</button>
      </div>
      <div class="date-filters">
        <div class="date-group"><span style="color:var(--accent-3)">ŸÖŸÜ:</span><div class="date-input-wrapper"><input type="date" id="start-date" class="date-input"></div></div>
        <div class="date-group"><span style="color:var(--accent-3)">ÿ•ŸÑŸâ:</span><div class="date-input-wrapper"><input type="date" id="end-date" class="date-input"></div></div>
      </div>
    </div>
    <div class="period-presets">
      <button class="preset-btn active" data-period="week">ÿ£ÿ≥ÿ®ŸàÿπŸä</button>
      <button class="preset-btn" data-period="biweekly">ŸÜÿµŸÅ ÿ¥Ÿáÿ±Ÿä</button>
      <button class="preset-btn" data-period="month">ÿ¥Ÿáÿ±Ÿä</button>
    </div>
    <div class="action-buttons">
      <button class="clear-filters-btn" id="clear-filters">üóëÔ∏è ŸÖÿ≥ÿ≠</button>
      <button class="download-pdf-btn" id="download-pdf-btn">üìÑ ÿ™ÿ≠ŸÖŸäŸÑ PDF</button>
    </div>
  </div>
</header>

<main id="articles-container">
  <div id="loading-indicator" style="text-align:center; padding:50px;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</div>
</main>

<div class="pagination-container" id="pagination-container"></div>

<div id="article-overlay">
  <div class="overlay-container">
    <div class="overlay-header-extended">
      <div id="overlay-article-title" style="color:white; font-weight:bold; font-size:1rem; flex:1;"></div>
      <button class="close-overlay" id="close-overlay">√ó</button>
    </div>
    <div class="article-frame-container">
      <iframe id="article-frame"></iframe>
    </div>
  </div>
</div>

<div id="pdf-temp-container"></div>

<script>
// ===== CONFIGURATION MISE √Ä JOUR =====
const CONFIG = {
  jsonUrl: 'data/datajson.json?t=' + Date.now(),
  logosUrl: 'data/logo_media.json?t=' + Date.now(),
  maxArticles: 1000,
  // Utilisation de la m√©thode GitHub demand√©e
  githubImageBase: 'https://github.com/marocnetmail/125/blob/main/images/img05/',
  githubImageSuffix: '?raw=true',
  debounceDelay: 300,
  articlesPerPage: 10
};

let appState = {
  articles: [],
  filteredArticles: [],
  searchQuery: '',
  startDate: null,
  endDate: null,
  currentPage: 1
};

// ===== FONCTION D'IMAGE CORRIG√âE =====
function getArticleImageUrl(article) {
  if (article.image_brute) {
    // Si c'est d√©j√† un lien complet (http), on le garde tel quel
    if (article.image_brute.startsWith('http')) {
      return article.image_brute;
    }
    // Nettoyer le nom du fichier et construire l'URL GitHub avec ?raw=true
    const fileName = article.image_brute.split('/').pop();
    return `${CONFIG.githubImageBase}${fileName}${CONFIG.githubImageSuffix}`;
  }
  return 'images/default.jpg';
}

// (Le reste de vos fonctions reste identique pour pr√©server la structure)
async function initApp() {
  setupEventListeners();
  setupPeriodPresets();
  loadArticles();
}

async function loadArticles() {
  try {
    const res = await fetch(CONFIG.jsonUrl);
    const data = await res.json();
    appState.articles = data.filter(a => a.visible === true || a.visible === "true");
    filterArticles();
  } catch (e) {
    document.getElementById('articles-container').innerHTML = "ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™";
  }
}

function filterArticles() {
  const query = appState.searchQuery.toLowerCase();
  appState.filteredArticles = appState.articles.filter(a => {
    return (a.titre?.toLowerCase().includes(query) || a.source?.toLowerCase().includes(query));
  });
  displayArticles();
  updatePagination();
}

function displayArticles() {
  const container = document.getElementById('articles-container');
  container.innerHTML = '';
  
  const start = (appState.currentPage - 1) * CONFIG.articlesPerPage;
  const pageArticles = appState.filteredArticles.slice(start, start + CONFIG.articlesPerPage);

  pageArticles.forEach(article => {
    const imageUrl = getArticleImageUrl(article);
    const card = document.createElement('div');
    card.className = 'article-card';
    card.innerHTML = `
      <div class="article-image-container">
        <img src="${imageUrl}" style="width:100%; height:100%; object-fit:cover;" onerror="this.src='images/default.jpg'">
        <div class="metadata-badges">
          <div class="metadata-badge date-badge">üìÖ ${article.date_heure.split(' ')[0]}</div>
          <div class="metadata-badge category-badge">üè∑Ô∏è ${article.theme || 'ÿπÿßŸÖ'}</div>
        </div>
        <div class="title-overlay">
          <h2 class="article-main-title">${article.titre}</h2>
          <div style="font-size:0.8rem; color:#4ECDC4;">üì∞ ${article.source}</div>
        </div>
      </div>
    `;
    card.onclick = () => {
      document.getElementById('overlay-article-title').textContent = article.titre;
      document.getElementById('article-frame').src = article.url;
      document.getElementById('article-overlay').style.display = 'block';
    };
    container.appendChild(card);
  });
}

// Fonctions de pagination et √©v√©nements (identiques √† l'original)
function updatePagination() {
  const container = document.getElementById('pagination-container');
  const total = Math.ceil(appState.filteredArticles.length / CONFIG.articlesPerPage);
  container.innerHTML = '';
  if(total <= 1) return;
  for(let i=1; i<=total; i++) {
    const btn = document.createElement('div');
    btn.className = `pagination-number ${i === appState.currentPage ? 'active' : ''}`;
    btn.textContent = i;
    btn.onclick = () => { appState.currentPage = i; displayArticles(); updatePagination(); window.scrollTo(0,0); };
    container.appendChild(btn);
  }
}

function setupPeriodPresets() {
  document.querySelectorAll('.preset-btn').forEach(btn => {
    btn.onclick = function() {
      document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      // Logique de date...
      filterArticles();
    };
  });
}

function setupEventListeners() {
  document.getElementById('search-input').oninput = (e) => {
    appState.searchQuery = e.target.value;
    appState.currentPage = 1;
    filterArticles();
  };
  document.getElementById('close-overlay').onclick = () => {
    document.getElementById('article-overlay').style.display = 'none';
    document.getElementById('article-frame').src = '';
  };
}

document.addEventListener('DOMContentLoaded', initApp);
</script>
</body>
</html>
